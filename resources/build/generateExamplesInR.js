var _ = require('lodash');

module.exports = function (parsedFileContents) {
  return new Promise( function (resolve, reject) {
    var content = '';

    content += '#NB auto generated by gulp build from resources/data/features.json\n'
    content += '\n'
    content += 'library(devtools)\n'
    // TEMPLATE! - this reponame needs to be updated to match your widget
    content += 'install_github("NumbersInternational/rhtmlTemplate")\n'

    _.forEach(parsedFileContents.features, function(feature) {
      content += '#' + feature.name + "\n";
      _.forEach(feature.scenarios, function(scenario) {
        content += '##' + scenario.name + "\n";
        _.forEach(scenario.description, function(line) {
          content += '###' + line + "\n";
        });
        content += "\n";

        // TEMPLATE! - this reponame needs to be updated to match your widget
        var rCommand = 'rhtmlTemplate::template(' +
          "'" + (scenario.settingsString || JSON.stringify(scenario.settings)) + "'" +
        ')';

        content += rCommand + "\n";
        content += "\n";
      });
    });
    return resolve(content);
  })
};
