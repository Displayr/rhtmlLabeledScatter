var _ = require('lodash');

module.exports = function (parsedFileContents) {
  return new Promise( function (resolve, reject) {
    var content = '';

    content += '#NB auto generated by gulp build from theSrc/features/features.json\n'
    content += '\n'
    content += 'library(devtools)\n'
    // TEMPLATE! - this reponame needs to be updated to match your widget
    content += 'install_github("Displayr/rhtmlLabeledScatter", auth_token="d8d69ec8f7941263cf1f9d1105292e698b803fce")\n'

    _.forEach(parsedFileContents.features, function(feature) {
      content += '#' + feature.name + "\n";
      _.forEach(feature.scenarios, function(scenario) {
        content += '##' + scenario.name + "\n";
        _.forEach(scenario.description, function(line) {
          content += '###' + line + "\n";
        });
        content += "\n";

        // TEMPLATE! - this reponame needs to be updated to match your widget
        var rCommand = 'rhtmlLabeledScatter::LabeledScatter(' +
          "'" + (JSON.stringify(scenario.config)) + "'" +
        ')';

        content += rCommand + "\n";
        content += "\n";
      });
    });
    return resolve(content);
  })
};
