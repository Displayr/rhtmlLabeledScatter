const _ = require('lodash');

module.exports = function (parsedFileContents) {
  return new Promise(function (resolve) {
    let content = '';

    content += '#NB auto generated by gulp build from theSrc/features/features.json\n';
    content += '\n';
    content += 'library(devtools)\n';
    content += 'install_github("Displayr/rhtmlLabeledScatter", auth_token="XXXXX")\n';

    _.forEach(parsedFileContents.features, function (feature) {
      content += `#${feature.name}\n`;
      _.forEach(feature.scenarios, function (scenario) {
        content += `##${scenario.name}\n`;
        _.forEach(scenario.description, function (line) {
          content += `###${line}\n`;
        });
        content += '\n';

        const rCommand = `${'rhtmlLabeledScatter::LabeledScatter(' +
          "'"}${JSON.stringify(scenario.config)}'` +
        ')';

        content += `${rCommand}\n`;
        content += '\n';
      });
    });
    return resolve(content);
  });
};
